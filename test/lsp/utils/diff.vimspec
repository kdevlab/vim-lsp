Describe lsp#utils#diff

    Describe lsp#utils#diff#compute
        It should return diff of one letter
            let lines1 = [
            \  'foo',
            \  'bar',
            \  'baz',
            \]
            let lines2 = [
            \  'foo',
            \  'baR',
            \  'baz',
            \]
            let want = {
            \  'range': {
            \    'start': { 'line': 1, 'character': 2 },
            \    'end': { 'line': 1, 'character': 3 },
            \  },
            \  'text': 'R',
            \  'rangeLength': 1
            \}
            let got = lsp#utils#diff#compute(lines1, lines2)
            Assert Equals(got, want)
        End

        It should return diff of multi-lines
            let lines1 = [
            \  'foo',
            \  'bar',
            \  'baz',
            \]
            let lines2 = [
            \  'Foo',
            \  'baR',
            \  'baz',
            \]
            let want = {
            \  'range': {
            \    'start': { 'line': 0, 'character': 0 },
            \    'end': { 'line': 1, 'character': 3, }
            \  },
            \  'text': "Foo\nbaR",
            \  "rangeLength": 7
            \}
            let got = lsp#utils#diff#compute(lines1, lines2)
            Assert Equals(got, want)
        End

        It should return diff for empty list
            let lines1 = []
            let lines2 = [
            \  'foo',
            \  'bar',
            \  'baz',
            \]
            let want = {
            \  'range': {
            \    'start': { 'line': 0, 'character': 0 },
            \    'end': { 'line': 0, 'character': 0, }
            \  },
            \  'text': "foo\nbar\nbaz\n",
            \  "rangeLength": 0
            \}
            let got = lsp#utils#diff#compute(lines1, lines2)
            Assert Equals(got, want)

            let lines1 = [
            \  'foo',
            \  'bar',
            \  'baz',
            \]
            let lines2 = []
            let want = {
            \  'range': {
            \    'start': { 'line': 0, 'character': 0 },
            \    'end': { 'line': 3, 'character': 0, }
            \  },
            \  'text': '',
            \  "rangeLength": 12
            \}
            let got = lsp#utils#diff#compute(lines1, lines2)
            Assert Equals(got, want)
        End

        It should return diff familier with utf-16 surrogate pairs
            let lines1 = [
            \  'foo',
            \]
            let lines2 = [
            \  'f𐐀o',
            \]
            let want = {
            \  'range': {
            \    'start': { 'line': 0, 'character': 1 },
            \    'end': { 'line': 0, 'character': 2 }
            \  },
            \  'text': '𐐀',
            \  "rangeLength": 1
            \}
            let got = lsp#utils#diff#compute(lines1, lines2)
            Assert Equals(got, want)

            let old_lsp_use_utf16 = get(g:, 'lsp_use_utf16', 0)

            try
                let g:lsp_use_utf16 = 0

                let lines1 = [
                \  'f𐐀o',
                \]
                let lines2 = [
                \  'foo',
                \]
                let want = {
                \  'range': {
                \    'start': { 'line': 0, 'character': 1 },
                \    'end': { 'line': 0, 'character': 5 }
                \  },
                \  'text': 'o',
                \  "rangeLength": 4
                \}
                let got = lsp#utils#diff#compute(lines1, lines2)
                Assert Equals(got, want)

                let g:lsp_use_utf16 = 1

                let lines1 = [
                \  'f𐐀o',
                \]
                let lines2 = [
                \  'foo',
                \]
                let want = {
                \  'range': {
                \    'start': { 'line': 0, 'character': 1 },
                \    'end': { 'line': 0, 'character': 3 }
                \  },
                \  'text': 'o',
                \  "rangeLength": 2
                \}
                let got = lsp#utils#diff#compute(lines1, lines2)
                Assert Equals(got, want)
            finally
                let g:lsp_use_utf16 = old_lsp_use_utf16
            endtry
        End
    End
End
